<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Device Mockup Builder</title>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://unpkg.com/html5-device-mockups/dist/device-mockups.min.css">

<style>
  :root{
    --bg:#0e1120;
    --panel:#161b36;
    --accent:#4da3ff;
    --ok:#1db954;
    --warn:#ffcc4d;
    --text:#ffffff;
  }
  html{scroll-behavior:smooth}
  body{background:var(--bg);color:var(--text);font-smooth:always;-webkit-font-smoothing:antialiased}
  a,button,select:focus,input:focus{outline:2px solid var(--accent);outline-offset:2px}
  .stage{max-width:1000px;margin:24px auto;padding-inline:12px}
  .panel{background:var(--panel);border-radius:12px;padding:16px;margin:16px auto;box-shadow:0 6px 24px rgba(0,0,0,.35)}
  .title-row{display:flex;justify-content:space-between;align-items:center;gap:12px}
  .helper{font-size:12px;opacity:.8}
  .btn-success{background:var(--ok);border-color:var(--ok)}
  .alert-warning{position:sticky;top:0;z-index:5;background:rgba(255,204,77,.15);border-color:var(--warn);color:#ffd978}

  /* Mockup scaling and crisp rendering */
  .device-stage{display:grid;place-items:center;margin-block:20px}
  .device-wrapper .device{
    width:clamp(260px, 48vw, 460px);
    margin:auto;
    transition:transform .2s ease;
  }
  .device-wrapper .device:hover{transform:translateY(-2px)}
  .device .screen, .device .screen>*{
    width:100%;height:100%
  }
  .device .screen{
    background:#000;
    overflow:hidden;
    will-change:transform;
    transform:translateZ(0);
  }
  .device .screen img, .device .screen video{
    object-fit:cover;
    image-rendering:auto;
    transform:translateZ(0);
  }

  /* Scroll container improvement */
  .scroll-shell{
    max-height:70vh;
    overflow:auto;
    scroll-behavior:smooth;
    scrollbar-width:thin;
    scrollbar-color:#3c4370 transparent;
    padding-right:6px;
  }
  .scroll-shell::-webkit-scrollbar{width:8px}
  .scroll-shell::-webkit-scrollbar-thumb{background:#3c4370;border-radius:8px}

  /* Compact controls on narrow screens */
  @media (max-width:576px){
    .form-row>.form-group{margin-bottom:.75rem}
  }
</style>
</head>
<body>
<div class="stage" id="top">
  <div class="title-row">
    <h4 class="mb-0">Device Mockup Builder by zayan</h4>
    <a class="btn btn-outline-light btn-sm" href="#mockupArea">Jump to preview</a>
  </div>

  <div class="panel">
    <div id="errorBox" class="alert alert-warning mb-3" style="display:none"></div>

    <div class="scroll-shell">
      <div class="form-row">
        <div class="form-group col-md-4 col-lg-3">
          <label>Device</label>
          <select id="deviceSelect" class="form-control">
            <option value="Chromebook">Chromebook</option>
            <option value="galaxyS3">Galaxy S3</option>
            <option value="galaxyS5">Galaxy S5</option>
            <option value="galaxyTab4">Galaxy Tab 4</option>
            <option value="HtcOneM8">HTC One M8</option>
            <option value="HuaweiP8">Huawei P8</option>
            <option value="iMac">iMac</option>
            <option value="iPad">iPad</option>
            <option value="iPadAir2">iPad Air 2</option>
            <option value="iPadPro">iPad Pro</option>
            <option value="iPhone6">iPhone 6</option>
            <option value="iPhone6Plus">iPhone 6 Plus</option>
            <option value="iPhoneSE">iPhone SE</option>
            <option value="iPhone5">iPhone 5</option>
            <option value="iPhone6Hand">iPhone 6 Hand</option>
            <option value="iPhone7Hand">iPhone 7 Hand</option>
            <option value="iPhone7Hand_2">iPhone 7 Hand 2</option>
            <option value="iPhone7">iPhone 7</option>
            <option value="iPhoneX">iPhone X</option>
            <option value="Lumia930">Lumia 930</option>
            <option value="Macbook">Macbook</option>
            <option value="Macbook2015">Macbook 2015</option>
            <option value="MacbookPro2015">MacbookPro 2015</option>
            <option value="Pixel">Pixel</option>
            <option value="SamsungTV">Samsung TV</option>
            <option value="SurfacePro3">Surface Pro 3</option>
            <option value="SurfaceStudio">Surface Studio</option>
          </select>
        </div>

        <div class="form-group col-md-4 col-lg-3">
          <label>Orientation</label>
          <select id="orientationSelect" class="form-control">
            <option value="portrait">portrait</option>
            <option value="landscape">landscape</option>
          </select>
        </div>

        <div class="form-group col-md-4 col-lg-3">
          <label>Color</label>
          <select id="colorSelect" class="form-control">
            <option value="black">black</option>
            <option value="white">white</option>
            <option value="gold">gold</option>
            <option value="pink">pink</option>
            <option value="red">red</option>
          </select>
        </div>

        <div class="form-group col-12 col-lg-3">
          <label>Upload image (incl. GIF) or MP4</label>
          <input id="fileInput" type="file" class="form-control-file" accept="image/*,video/mp4">
          <small class="helper d-block mt-1">Local files only. Video must be MP4.</small>
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-end gap-2">
      <button id="downloadBtn" class="btn btn-success">Download media</button>
      <button id="clearBtn" class="btn btn-outline-light">Clear</button>
    </div>
  </div>

  <div id="mockupArea" class="device-stage" style="scroll-margin-top:90px">
    <div class="device-wrapper">
      <div id="mockup" class="device" data-device="iPhoneSE" data-orientation="portrait" data-color="black">
        <div id="screen" class="screen"></div>
        <div class="button"></div>
      </div>
    </div>
  </div>
</div>

<script>
  // Strict whitelist to prevent sprite misses
  const MAP = {
    Chromebook:{o:['portrait'],c:['black']},
    galaxyS3:{o:['portrait','landscape'],c:['black','white']},
    galaxyS5:{o:['portrait','landscape'],c:['black','white','gold']},
    galaxyTab4:{o:['portrait'],c:['black']},
    HtcOneM8:{o:['portrait','landscape'],c:['black']},
    HuaweiP8:{o:['portrait','landscape'],c:['gold']},
    iMac:{o:['portrait'],c:['black']},
    iPad:{o:['portrait','landscape'],c:['black','white']},
    iPadAir2:{o:['portrait','landscape'],c:['black','white','gold']},
    iPadPro:{o:['portrait','landscape'],c:['black','white','gold']},
    iPhone6:{o:['portrait','landscape'],c:['black','white','gold']},
    iPhone6Plus:{o:['portrait','landscape'],c:['black','white','gold']},
    iPhoneSE:{o:['portrait','landscape'],c:['black','white','gold','pink']},
    iPhone5:{o:['portrait','landscape'],c:['black','white']},
    iPhone6Hand:{o:['portrait'],c:['black','white']},
    iPhone7Hand:{o:['portrait'],c:['black']},
    iPhone7Hand_2:{o:['portrait'],c:['black']},
    iPhone7:{o:['portrait','landscape'],c:['black','white','gold','pink','red']},
    iPhoneX:{o:['portrait','landscape'],c:['black']},
    Lumia930:{o:['portrait','landscape'],c:['black','white']},
    Macbook:{o:['portrait'],c:['black','white','gold']},
    Macbook2015:{o:['portrait'],c:['black','white','gold']},
    MacbookPro2015:{o:['portrait'],c:['black']},
    Pixel:{o:['portrait'],c:['black','white']},
    SamsungTV:{o:['landscape'],c:['black']},
    SurfacePro3:{o:['landscape'],c:['black']},
    SurfaceStudio:{o:['portrait'],c:['black']}
  };

  const mockup = document.getElementById('mockup');
  const screen = document.getElementById('screen');
  const errorBox = document.getElementById('errorBox');

  let lastValid = {device:'iPhoneSE',orientation:'portrait',color:'black'};
  function showError(msg){
    errorBox.textContent = msg;
    errorBox.style.display='block';
  }
  function clearError(){
    errorBox.style.display='none';
    errorBox.textContent='';
  }

  function applyAttrs(){
    const dev = document.getElementById('deviceSelect').value;
    const ori = document.getElementById('orientationSelect').value;
    const col = document.getElementById('colorSelect').value;
    const spec = MAP[dev];

    if(!spec){ showError(`Unknown device "${dev}".`); revert(); return; }
    if(!spec.o.includes(ori)){ showError(`Orientation "${ori}" not supported by ${dev}. Allowed: ${spec.o.join(', ')}.`); revert(); return; }
    if(!spec.c.includes(col)){ showError(`Color "${col}" not supported by ${dev}. Allowed: ${spec.c.join(', ')}.`); revert(); return; }

    clearError();
    mockup.setAttribute('data-device', dev);
    mockup.setAttribute('data-orientation', ori);
    mockup.setAttribute('data-color', col);
    lastValid = {device:dev,orientation:ori,color:col};
  }
  function revert(){
    mockup.setAttribute('data-device', lastValid.device);
    mockup.setAttribute('data-orientation', lastValid.orientation);
    mockup.setAttribute('data-color', lastValid.color);
  }
  ['deviceSelect','orientationSelect','colorSelect'].forEach(id=>{
    document.getElementById(id).addEventListener('change', applyAttrs);
  });
  applyAttrs();

  // Media handling (local only)
  let currentFile=null, objectUrl=null;
  function clearScreen(){
    if(objectUrl) URL.revokeObjectURL(objectUrl);
    objectUrl=null; currentFile=null; screen.innerHTML='';
  }
  document.getElementById('clearBtn').addEventListener('click', clearScreen);

  document.getElementById('fileInput').addEventListener('change', e=>{
    clearScreen();
    const f = e.target.files && e.target.files[0];
    if(!f) return;
    if(!(f.type.startsWith('image/') || f.type==='video/mp4')){
      showError('Unsupported file. Upload an image (including GIF) or MP4 video.');
      e.target.value=''; return;
    }
    clearError();
    currentFile=f; objectUrl=URL.createObjectURL(f);

    if(f.type.startsWith('image/')){
      const img = new Image();
      img.onload = ()=>{ /* ensure GPU layer ready */ img.style.willChange='transform'; };
      img.src = objectUrl;
      img.style.width='100%'; img.style.height='100%'; img.style.objectFit='cover';
      img.alt=f.name;
      screen.appendChild(img);
    }else{
      const v=document.createElement('video');
      v.src=objectUrl; v.autoplay=true; v.loop=true; v.muted=true; v.playsInline=true; v.controls=true;
      v.style.width='100%'; v.style.height='100%'; v.style.objectFit='cover';
      screen.appendChild(v);
    }
  });

  // Reliable download preserving type/extension
  function downloadBlobUrl(file, url){
    const a=document.createElement('a');
    a.href=url;
    a.download=file.name || (file.type==='video/mp4'?'video.mp4':'image');
    a.style.display='none';
    document.body.appendChild(a);
    a.click();
    // Delay revoke to avoid abort
    setTimeout(()=>{ document.body.removeChild(a); try{URL.revokeObjectURL(url);}catch(e){} }, 1000);
  }
  document.getElementById('downloadBtn').addEventListener('click', ()=>{
    if(!currentFile || !objectUrl){
      showError('Nothing to download. Upload an image (incl. GIF) or MP4 first.');
      return;
    }
    clearError();
    downloadBlobUrl(currentFile, objectUrl);
    // Keep preview alive by creating a fresh URL
    objectUrl = URL.createObjectURL(currentFile);
  });
</script>
</body>
</html>
