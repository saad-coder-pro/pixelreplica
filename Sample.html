<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mockup Builder â€” Validated + Reliable Download</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://unpkg.com/html5-device-mockups/dist/device-mockups.min.css">
<style>
  body{background:#0f1220;color:#fff}
  .stage{max-width:1000px;margin:24px auto}
  .panel{background:#1b2140;border-radius:8px;padding:16px;margin:16px auto}
  .device-wrapper .device{width:380px;margin:auto}
  .device .screen, .device .screen>*{width:100%;height:100%}
  .helper{font-size:12px;opacity:.8}
  #errorBox{display:none}
</style>
</head>
<body>
<div class="container stage">
  <h4 class="mb-3">Device Mockup Builder</h4>

  <div class="panel">
    <div id="errorBox" class="alert alert-warning mb-3"></div>

    <div class="form-row">
      <div class="form-group col-md-4 col-lg-3">
        <label>Device</label>
        <select id="deviceSelect" class="form-control">
          <option value="Chromebook">Chromebook</option>
          <option value="galaxyS3">Galaxy S3</option>
          <option value="galaxyS5">Galaxy S5</option>
          <option value="galaxyTab4">Galaxy Tab 4</option>
          <option value="HtcOneM8">HTC One M8</option>
          <option value="HuaweiP8">Huawei P8</option>
          <option value="iMac">iMac</option>
          <option value="iPad">iPad</option>
          <option value="iPadAir2">iPad Air 2</option>
          <option value="iPadPro">iPad Pro</option>
          <option value="iPhone6">iPhone 6</option>
          <option value="iPhone6Plus">iPhone 6 Plus</option>
          <option value="iPhoneSE">iPhone SE</option>
          <option value="iPhone5">iPhone 5</option>
          <option value="iPhone6Hand">iPhone 6 Hand</option>
          <option value="iPhone7Hand">iPhone 7 Hand</option>
          <option value="iPhone7Hand_2">iPhone 7 Hand 2</option>
          <option value="iPhone7">iPhone 7</option>
          <option value="iPhoneX">iPhone X</option>
          <option value="Lumia930">Lumia 930</option>
          <option value="Macbook">Macbook</option>
          <option value="Macbook2015">Macbook 2015</option>
          <option value="MacbookPro2015">MacbookPro 2015</option>
          <option value="Pixel">Pixel</option>
          <option value="SamsungTV">Samsung TV</option>
          <option value="SurfacePro3">Surface Pro 3</option>
          <option value="SurfaceStudio">Surface Studio</option>
        </select>
      </div>

      <div class="form-group col-md-4 col-lg-3">
        <label>Orientation</label>
        <select id="orientationSelect" class="form-control">
          <option value="portrait">portrait</option>
          <option value="landscape">landscape</option>
        </select>
      </div>

      <div class="form-group col-md-4 col-lg-3">
        <label>Color</label>
        <select id="colorSelect" class="form-control">
          <option value="black">black</option>
          <option value="white">white</option>
          <option value="gold">gold</option>
          <option value="pink">pink</option>
          <option value="red">red</option>
        </select>
      </div>

      <div class="form-group col-12 col-lg-3">
        <label>Upload image (incl. GIF) or MP4</label>
        <input id="fileInput" type="file" class="form-control-file" accept="image/*,video/mp4">
        <small class="helper d-block mt-1">Local files only. Video must be MP4.</small>
      </div>
    </div>

    <div class="text-right">
      <button id="downloadBtn" class="btn btn-success">Download media</button>
      <button id="clearBtn" class="btn btn-outline-light">Clear</button>
    </div>
  </div>

  <div class="device-wrapper">
    <div id="mockup" class="device" data-device="iPhoneSE" data-orientation="portrait" data-color="black">
      <div id="screen" class="screen"></div>
      <div class="button"></div>
    </div>
  </div>
</div>

<script>
  const screen = document.getElementById('screen');
  const mockup = document.getElementById('mockup');
  const errorBox = document.getElementById('errorBox');

  // Supported combinations derived from the library assets listing on CDN
  // For brevity, include the most commonly used devices; add more as needed.
  const supportedOptions = {
    Chromebook: { orientations:['portrait'], colors:['black'] },
    galaxyS3: { orientations:['portrait','landscape'], colors:['black','white'] },
    galaxyS5: { orientations:['portrait','landscape'], colors:['black','white','gold'] },
    galaxyTab4: { orientations:['portrait'], colors:['black'] },
    HtcOneM8: { orientations:['portrait','landscape'], colors:['black'] },
    HuaweiP8: { orientations:['portrait','landscape'], colors:['gold'] },
    iMac: { orientations:['portrait'], colors:['black'] },
    iPad: { orientations:['portrait','landscape'], colors:['black','white'] },
    iPadAir2: { orientations:['portrait','landscape'], colors:['black','white','gold'] },
    iPadPro: { orientations:['portrait','landscape'], colors:['black','white','gold'] },
    iPhone6: { orientations:['portrait','landscape'], colors:['black','white','gold'] },
    iPhone6Plus: { orientations:['portrait','landscape'], colors:['black','white','gold'] },
    iPhoneSE: { orientations:['portrait','landscape'], colors:['black','white','gold','pink'] },
    iPhone5: { orientations:['portrait','landscape'], colors:['black','white'] },
    iPhone6Hand: { orientations:['portrait'], colors:['black','white'] },
    iPhone7Hand: { orientations:['portrait'], colors:['black'] },
    iPhone7Hand_2: { orientations:['portrait'], colors:['black'] },
    iPhone7: { orientations:['portrait','landscape'], colors:['black','white','gold','pink','red'] },
    iPhoneX: { orientations:['portrait','landscape'], colors:['black'] },
    Lumia930: { orientations:['portrait','landscape'], colors:['black','white'] },
    Macbook: { orientations:['portrait'], colors:['black','white','gold'] },
    Macbook2015: { orientations:['portrait'], colors:['black','white','gold'] },
    MacbookPro2015: { orientations:['portrait'], colors:['black'] },
    Pixel: { orientations:['portrait'], colors:['black','white'] },
    SamsungTV: { orientations:['landscape'], colors:['black'] },
    SurfacePro3: { orientations:['landscape'], colors:['black'] },
    SurfaceStudio: { orientations:['portrait'], colors:['black'] }
  }; // Built from the asset list on cdnjs. [3]

  function showError(msg){
    errorBox.textContent = msg;
    errorBox.style.display = 'block';
  }
  function clearError(){
    errorBox.style.display = 'none';
    errorBox.textContent = '';
  }

  function applyAttrs(){
    clearError();
    const dev = document.getElementById('deviceSelect').value;
    const ori = document.getElementById('orientationSelect').value;
    const col = document.getElementById('colorSelect').value;

    const sup = supportedOptions[dev];
    if(!sup){
      showError(`Unknown device "${dev}".`);
      return;
    }
    if(!sup.orientations.includes(ori)){
      showError(`Orientation "${ori}" is not supported for ${dev}. Supported: ${sup.orientations.join(', ')}.`);
      return;
    }
    if(!sup.colors.includes(col)){
      showError(`Color "${col}" is not supported for ${dev}. Supported: ${sup.colors.join(', ')}.`);
      return;
    }

    mockup.setAttribute('data-device', dev);
    mockup.setAttribute('data-orientation', ori);
    mockup.setAttribute('data-color', col);
  }
  ['deviceSelect','orientationSelect','colorSelect'].forEach(id=>{
    document.getElementById(id).addEventListener('change', applyAttrs);
  });
  applyAttrs();

  // Media handling
  let currentFile = null;
  let objectUrl = null;

  function clearScreen(){
    if(objectUrl) URL.revokeObjectURL(objectUrl);
    objectUrl = null;
    currentFile = null;
    screen.innerHTML = '';
  }
  document.getElementById('clearBtn').addEventListener('click', clearScreen);

  document.getElementById('fileInput').addEventListener('change', (e)=>{
    clearScreen();
    const f = e.target.files && e.target.files;
    if(!f) return;

    if (!(f.type.startsWith('image/') || f.type === 'video/mp4')) {
      showError('Unsupported file. Use an image (incl. GIF) or an MP4 video.');
      e.target.value='';
      return;
    }
    clearError();

    currentFile = f;
    objectUrl = URL.createObjectURL(f);

    if (f.type.startsWith('image/')) {
      const img = document.createElement('img');
      img.src = objectUrl;
      img.style.objectFit='cover';
      img.style.width='100%';
      img.style.height='100%';
      img.alt = f.name;
      screen.appendChild(img);
    } else {
      const video = document.createElement('video');
      video.src = objectUrl;
      video.autoplay = true;
      video.loop = true;
      video.muted = true;
      video.playsInline = true;
      video.controls = true;
      video.style.objectFit='cover';
      video.style.width='100%';
      video.style.height='100%';
      screen.appendChild(video);
    }
  });

  // Robust download helper (works across browsers)
  function downloadFileFromObjectURL(file, objUrl){
    const a = document.createElement('a');
    a.href = objUrl;
    a.download = file.name || (file.type === 'video/mp4' ? 'video.mp4' : 'image');
    a.style.display = 'none';
    document.body.appendChild(a);
    a.click();
    setTimeout(()=>{ // allow browsers to start the download
      document.body.removeChild(a);
      try{ URL.revokeObjectURL(objUrl); }catch(e){}
    }, 800);
  } // Uses anchor download + delayed revoke for reliability. [7][12][9][11]

  document.getElementById('downloadBtn').addEventListener('click', ()=>{
    if(!currentFile || !objectUrl){
      showError('Nothing to download. Upload an image (incl. GIF) or MP4 first.');
      return;
    }
    clearError();
    downloadFileFromObjectURL(currentFile, objectUrl);
    // Re-create fresh object URL so preview keeps working after revoke
    objectUrl = URL.createObjectURL(currentFile);
  });
</script>
</body>
</html>
